<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <style> 
    html,
body {
  height: 100%;
}

#page-content {
  flex: 1 0 auto;
}
.carrito{
  width: 35%;
  height: 100%;
  border-left: 1px solid #616161;
  position: fixed;
  margin-left: 65%;
  background-color: white;
  visibility:hidden;
}
.cerrarcarrito{
  margin-left: 5px;
  margin-top: 15px;
}
    </style>
</head>
<body class="d-flex flex-column"    >
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">Aplicacion carrito</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                        <li class="nav-item"><a class="nav-link" href="#!">Ultimas compras</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Catalogo</a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><button class="dropdown-item" onclick="actualizar()">Todos los productos</button></li>
                                <li><hr class="dropdown-divider" /></li>
                                <li><button class="dropdown-item" onclick="actualizarult()">Ultimas unidades</button></li>
                                <li><button class="dropdown-item" onclick="actualizarmu()">Unidades con mucho stock</button></li>
                            </ul>
                        </li>
                        
                    </ul>
                    <button class="btn btn-outline-dark" type="button" onclick="carrito()">
                            <i class="bi-cart-fill me-1"></i>
                            Carrito
                            <span class="badge bg-dark text-white ms-1 rounded-pill">0</span>
                        </button>
                    <div class="navbar-nav  mb-2 mb-lg-0 ms-lg-4">
                        <a class="nav-link active" aria-current="page" href="#!">Identificarse/Registrarse</a>
                    </div>
                </div>
            </div>
        </nav>
        <div id="page-content">
            <div class="container text-center">
              <div class="row justify-content-center" id="content">
                
              </div>
            </div>
        </div>
        <div class="carrito" id="carrito">
          <button type="button" class="btn-close cerrarcarrito" data-bs-dismiss="modal" aria-label="Close" onclick="cerrarcarrito()"></button>
          <hr>
        </div>

        <footer id="sticky-footer" class="flex-shrink-0 py-4 bg-dark text-white-50">
            <div class="container text-center">
              <small>Copyright &copy; Your Website</small>
            </div>
          </footer>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const articulos=[];
  var art=false;
  function actualizar(datos){$.ajax({
    type: "POST",
    dataType: "json",
    url: "ajax/ajaxarticulos.php",
    data: datos,
    success: function(data) {
      document.getElementById("content").innerHTML = "";
      data.forEach(function(articulo){
        console.log(articulo);
        if(!art){
        articulos[parseInt(articulo['codArticulo']  )]=articulo;
        
        }
        document.getElementById("content").innerHTML+="<div class=\"row\"><div class=\"col-md-4\" id=\"pop\"><button type=\"button\" class=\"btn\" data-bs-toggle=\"modal\" data-bs-target=\"#modal"
          +articulo['codArticulo']+
          "\"><img class=\"img-fluid rounded mb-3 mb-md-0\" src=\"img/"+articulo['codArticulo']+".png\" alt=\"\" style=\"max-height:100px\"></button></div><div class=\"col-md-8\"><h3>"+articulo['nombre']+
            "</h3>"+(parseInt(articulo['cantidad'])<=parseInt(articulo['cantidadMinima'])?"<h5 class=\"ultimas\">Ultimas unidades de este articulo</h5>":"")+"<input name=\"cant\" id=\"cantidad"+articulo['codArticulo']+"\" type=\"number\" value=\"1\" min=\"1\" max=\""+articulo['cantidad']+"\" > x "+(parseFloat(articulo['PVP'])*(parseFloat(articulo['IVA'])+1)).toFixed(2)+"€ = <span id=\"spn"+articulo['codArticulo']+"\">"+(parseFloat(articulo['PVP'])*(parseFloat(articulo['IVA'])+1)).toFixed(2)+"</span>€ <button class=\"btn btn-primary\">Añadir al carrito</button></div></div><div class=\"modal fade\" id=\"modal"
            +articulo['codArticulo']+"\" tabindex=\"-1\" aria-labelledby=\"modalLabel"
            +articulo['codArticulo']+"\" aria-hidden=\"true\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><h1 class=\"modal-title fs-5\" id=\"exampleModalLabel\">"
            +articulo['nombre']+"</h1><button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button></div><div class=\"modal-body\"><img class=\"img-fluid rounded mb-3 mb-md-0\" src=\"img/"
            +articulo['codArticulo']+".png\" alt=\"\" style=\"height:auto;width:600px\"></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cerrar</button></div></div></div></div><hr style=\"margin-top:10px\">";
      });
      art=true;
    },
    error: function(data){
       console.log("Error");
    }
});
};
function actualizarult(){
  actualizar('pocos=1');
}
function actualizarmu(){
  actualizar('pocos=0');
}
function carrito(){
  document.getElementById('carrito').style.visibility="visible";
}
function cerrarcarrito(){
  document.getElementById('carrito').style.visibility="hidden";
}

function cambio(id){
  document.getElementById('cantidad'+id).innerHTML=document.getElementById('cantidad'+id).value*(parseFloat(articulos[id]['PVP'])*(parseFloat(articulos[id]['IVA'])+1)).toFixed(2);
}

$(document).ready(function(){
  $('input[name="cant"]').on('change', function() {
    var idElemento = $(this).attr('id');
    console.log('El ID del elemento es: ' + idElemento);
  });
});
actualizar("");

console.log('articulos');
console.log(articulos);



</script>
</html>